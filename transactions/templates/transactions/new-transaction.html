<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>New Transaction</title>
  <link href="css/style.css" rel="stylesheet">
</head>

<body>
   <h1>New Transaction</h1>
  <form action="" method="post">
    {% csrf_token %}
    <!-- renders form fiels as paragraphs -->
    {{ form.as_p }}
    <button type="submit">save</button>
  </form>
<hr>

    <h2>Recent Transactions</h2>
    <table id="transactionTable">
      <tr>
        <th>Category</th>
        <th>Amount</th>
      </tr>

    {% for transaction in transactions %}
      <tr>
        <td>{{ transaction.category}}</td>
        <td>{{ transaction.amount}}</td>
      </tr>
    {% endfor %}

      <tr>
        <td><b>Total</b></td>
        <td><b>{{ total }}</b></td>
      </tr>
    </table>  

<script>
document.getElementById('transactionForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);

    fetch(window.location.href, {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest'  // This tells Django it's AJAX!
        }
    })
    .then(response => {
        if (!response.ok) throw new Error('Network error');
        return response.json();
    })
    .then(data => {
        if (data.errors) {
            alert('Error: ' + JSON.stringify(data.errors));
        } else {
            // Add new row to the table
            const table = document.getElementById('transactionTable');
            const newRow = table.insertRow(1);
            newRow.innerHTML = `
                <td>${data.category}</td>
                <td>${data.amount}</td>
                <td>${data.date}</td>
            `;
            this.reset();
        }
    })
    .catch(error => console.error('Error:', error));
});
</script>
</body>

</html>
